name: Check for changes in cp.yml and push to main
on:
  push:
    # branches:
    #   - dev
    paths:
      - '.github/workflows/cp.yml'
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          ref: main
      - name: Run if cp.yml has changed
        uses: actions/github-script@v5
        with:
          script: |
            const { owner, repo } = context.repo;
            const branch = 'main';
            const path = '.github/workflows/cp.yml';
            const message = 'Update cp.yml';
            const content = await github.repos.getContent({
              owner,
              repo,
              path,
              ref: 'dev'
            });
            const sha = content.data.sha;
            const encodedContent = content.data.content;
            await github.repos.createOrUpdateFileContents({
              owner,
              repo,
              path,
              branch,
              message,
              content: encodedContent,
              sha
            });